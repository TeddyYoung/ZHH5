angular.module("oil.cardChangeCtrl",["oil.UtilService","oil.services","oil.UserService"]).controller("cardChangeCtrl",function($scope,$log,$ionicHistory,$state,servicesRequest,Util,User,$ionicLoading,$location,Storage){$scope.cardInfo={show_card:"",card_pwd:"",name:""};$scope.changeVerify=function(){$scope.checked=false;$scope.checked=!$scope.checked;};$scope.cardChanges=function(){$(".read-only").attr("read-only","true");var token=$location.search().token;if(token==null||token==""){token=User.getToken();}
  Storage.set("token",token);servicesRequest.cardChange($scope.formData.cardno,$scope.cardInfo.card_pwd,token).success(function(data){var statusCode=data.code;var message=data.message;if(statusCode==100){var content=JSON.parse(data.content);Util.ionicPopupAlert("保存成功").then(function(res){$state.go("tab.home");});}else{Util.ionicPopupAlert(message);}}).error(function(error){Util.ionicPopupAlert("绑定失败，请重试！");}).finally(function(){});};var checkCards=function(){var token=$location.search().token;if(token==null||token==""){token=User.getToken();}
  Storage.set("token",token);servicesRequest.recheckCardsService(token).success(function(data){$ionicLoading.hide();var statusCode=data.code;var message=data.message;if(statusCode==100){var content=JSON.parse(data.content);if(content==''){Util.ionicPopupAlert("暂无可更换的会员卡").then(function(){$state.go("tab.home");});}else{$scope.cardInfo=content;$scope.formData={};}}else{}}).error(function(error){Util.ionicPopupAlert("绑定失败，请重试!").then(function(){$state.go("tab.home");});}).finally(function(){});};$scope.$on("$ionicView.beforeEnter",function(){checkCards();});});
