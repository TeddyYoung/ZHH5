angular.module('oil.getMCardCtrl',['oil.UtilService','oil.services','oil.UserService']).controller('getMCardCtrl',function($interval,$http,$rootScope,$location,$scope,$log,$ionicHistory,$state,Storage,servicesRequest,Util,User,$ionicScrollDelegate){var pagecount=7;var getMCard=function(begin_date,nid,token){servicesRequest.listTransService(begin_date,nid,token).success(function(data){var statusCode=data.code;var message=data.message;var content=data.content;if(statusCode==100){if(content!=""){var contents=JSON.parse(data.content);$scope.content=contents;$scope.hasSe=false;$scope.nid=$scope.content[0].nid;if($scope.nid>=8){$scope.hasSe=true;}else{$scope.hasSe=false;}
  if($scope.content[0].workdate==""){$scope.flag=false;}else{$scope.flag=true;}}else{var contents=data.content;}}else{Util.ionicPopupAlert(message);}}).error(function(){}).finally(function(){})}
  var token=$location.search().token;if(token==null||token==''){token=User.getToken();}
  Storage.set("token",token);var begin_date='2015-01-10';var nid="";$scope.$on('$ionicView.beforeEnter',function(){getMCard(begin_date,nid,token);if($ionicScrollDelegate.scrollTop){$ionicScrollDelegate.scrollTop();}});$scope.hasmore=true;$scope.loadMore=function(){var nid=$scope.content[$scope.content.length-1].nid;if($scope.hasmore==true){servicesRequest.listTransService(begin_date,nid,token).success(function(data){var statusCode=data.code;var message=data.message;var content=data.content;if(statusCode==100){if(content!=""){var content=JSON.parse(data.content);for(var i=0;i<content.length;i++){$scope.content.push(content[i]);}
    if(content.length<pagecount){$scope.hasmore=false;}}else{$scope.hasSe=false;$scope.hasmore=false;}}else{Util.ionicPopupAlert(message);}}).error(function(){}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete');})}else{$scope.$broadcast('scroll.infiniteScrollComplete');}}})
