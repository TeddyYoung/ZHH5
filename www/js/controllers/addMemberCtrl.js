angular.module("oil.addMemberCtrl",["oil.UtilService","oil.services","oil.UserService"]).controller("addMemberCtrl",function($scope,$log,$ionicHistory,$state,Util,servicesRequest,User,$ionicLoading,$location,Storage,$rootScope){$scope.getBack=function(){$ionicHistory.goBack();};$scope.getBind=function(){$state.go("tab.bindOldCard",{reload:true});};$scope.getAgreement=function(){$state.go("tab.meetAgreement");};$scope.$on("$ionicView.beforeEnter",function(){$rootScope.hideTabs=true;});$scope.clickGoBack=function(){$ionicHistory.goBack();$rootScope.hideTabs=false;};$scope.memberInfo={name:"",id_card:"",phone:""};$scope.checked=false;$scope.changeVerify=function(){$scope.checked=!$scope.checked;};$scope.AddMember=function(){var token=$location.search().token;if(token==null||token==""){token=User.getToken();}
  Storage.set("token",token);servicesRequest.AddMemberService($scope.memberInfo.phone,token).success(function(data){$ionicLoading.hide();var statusCode=data.code;var message=data.message;if(statusCode==100){$log.log("data>>>>",data);Util.ionicPopupAlert("保存成功").then(function(res){$state.go("tab.home");});$scope.contents=data.content;}else{Util.ionicPopupAlert(message);}}).error(function(error){Util.ionicPopupAlert("新增会员失败，请重试！");}).finally(function(){});};var AliUser=function(){var token=$location.search().token;if(token==null||token==""){token=User.getToken();}
  Storage.set("token",token);servicesRequest.AliUserService(token).success(function(data){$ionicLoading.hide();var statusCode=data.code;var message=data.message;if(statusCode==100){var content=JSON.parse(data.content);$scope.memberInfo=content;}else{Util.ionicPopupAlert(message);}}).error(function(error){Util.ionicPopupAlert("读取会员信息失败，请重试！");}).finally(function(){});};$scope.$on("$ionicView.beforeEnter",function(){AliUser();});});
